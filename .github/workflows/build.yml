name: Build AfterGL

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Code
      uses: actions/checkout@v4

    - name: Install Dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y \
          libglfw3-dev \
          libglm-dev \
          libgl1-mesa-dev \
          libglu1-mesa-dev \
          xvfb \
          xauth

    - name: Compile AfterGL
      run: |
        g++ anim.cpp AfterGL/src/AfterGL.cpp AfterGL/src/glad.c -o gradius \
          -I AfterGL/include \
          -lglfw -lGL -ldl -lpthread

    - name: Test Initialization (Headless)
      run: |
        # Use xvfb-run to start a virtual display so the engine can Init()
        xvfb-run --auto-servernum ./gradius &
        sleep 5
        kill $!
