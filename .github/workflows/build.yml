name: AfterGL Library Build

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  validate-library:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Code
      uses: actions/checkout@v4

    - name: Install 3D Dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y \
          libglfw3-dev \
          libglm-dev \
          libgl1-mesa-dev \
          libglu1-mesa-dev

    - name: Auto-Detect and Compile
      run: |
        # Find the directories for src and include regardless of nesting
        SRC_DIR=$(find . -name "AfterGL.cpp" -exec dirname {} \;)
        INC_DIR=$(find . -name "AfterGL.h" -exec dirname {} \;)

        if [ -z "$SRC_DIR" ]; then
          echo "Error: Could not find AfterGL.cpp in the repository."
          ls -R
          exit 1
        fi

        echo "Found source in: $SRC_DIR"
        echo "Found headers in: $INC_DIR"

        # Compile from the detected locations
        g++ -c "$SRC_DIR/AfterGL.cpp" "$SRC_DIR/glad.c" \
          -I "$INC_DIR" \
          -fPIC

    - name: Success Check
      run: echo "Library validation complete."s
